## :bookmark: RuståŸºç¡€

### ç®€ä»‹

**Rust** -- ä¸€ç§é™æ€ç±»å‹ _(statically typed)_, æ²¡æœ‰åƒåœ¾å›æ”¶ _(garbage collector, GC)_ çš„è¯­è¨€

### æ³¨é‡Š

#### å¸¸è§„æ³¨é‡Š
```rust
// è¡Œæ³¨é‡Š
/*
    å—æ³¨é‡Š
*/
```

#### æ–‡æ¡£æ³¨é‡Š
```rust
/*! 
//! 
/// 
```

*TODO: å…³äºæ³¨é‡Šå¾…è¡¥å…… ğŸ˜œ*

### å˜é‡å’Œå¸¸é‡çš„è§„åˆ™

å£°æ˜å˜é‡ **å˜é‡é»˜è®¤ä¸å¯å˜(immutable)**

```rust
let variable = 0;
// variable = 1;
```
ä¸èƒ½å¯¹ä¸å¯å˜å˜é‡äºŒæ¬¡èµ‹å€¼() å¯ä»¥åœ¨å˜é‡å‰ä¿®é¥° `mut` ä½¿å˜é‡å¯å˜. è¿˜å‘coderè¡¨æ˜å…¶ä»–ä»£ç å¯èƒ½ä¼šæ”¹å˜è¿™ä¸ªå˜é‡çš„å€¼
```rust
let mut vaiable = 0;
variable  = 1;
```

å˜é‡é‡å¤å£°æ˜(éšè—/ Shadowing)
```rust
let mut variable = "Hello Rust, I'm yakir !";
// variable = variable.len(); // ä¸å…è®¸ä¿®æ”¹å˜é‡ç±»å‹
let variable = 0;
let variable = String::new(); // variable éšè—ä¹‹å‰å£°æ˜çš„åŒåå˜é‡
let mut variable = "Bonjour !";
```

å£°æ˜å¸¸é‡
```rust
const YEAR: u32 = 2018;
```
å¸¸é‡å£°æ˜é¡»æŒ‡å®šå¸¸é‡å€¼ç±»å‹(è¿™é‡Œä¸º `u32`)

### å†…å»ºç±»å‹ä¹‹ä¸€: æ ‡é‡(scalar)

**æ ‡é‡**ç±»å‹ä»£è¡¨å•è¯»ä¸€ä¸ªå€¼. Rust æœ‰å››ç§æ ‡é‡ç±»å‹: æ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”å‹å’Œå­—ç¬¦å‹

#### æ•´å‹

Rust é»˜è®¤æ•°å­—ç±»å‹æ˜¯ `i32`  
|é•¿åº¦|æœ‰ç¬¦å·|æ— ç¬¦å·|
|:---|:---|:---|
|8-bit|i8|u8|
|16-bit|i16|u16|
|32-bit|i32|u32|
|64-bit|i64|u64|
|arch|isize|usize|

#### æµ®ç‚¹å‹
Rust é»˜è®¤æµ®ç‚¹å‹æ˜¯ `f64`
|é•¿åº¦|æµ®ç‚¹å‹|è¡¨ç¤º|
|:---|:---|:---|
|32-bit|f32|å•ç²¾åº¦æµ®ç‚¹|
|64-bit|f64|åŒç²¾åº¦æµ®ç‚¹|

#### å¸ƒå°”å‹
`bool` ç±»å‹åªæœ‰ä¸¤ä¸ªå€¼ `true` å’Œ `false`

#### å­—ç¬¦å‹
`char` ç±»å‹ä»£è¡¨ä¸€ä¸ª Unicode æ ‡é‡(Unicode Scalar Value åŒ…å« `U+0000` åˆ° `U+D7FF` å’Œ `U+E000` åˆ° `U+10FFFF` åœ¨å†…çš„å€¼)

### å†…å»ºç±»å‹ä¹‹äºŒ: å¤åˆ(compound)

#### å…ƒç»„
å°†ä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒç±»å‹çš„å€¼ç»„åˆæˆä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼  
åˆ›å»ºä½¿ç”¨å…ƒç»„  
```rust
let tuple: (i32, f32, f64, bool, u8) = (1, -2.1, 3.0, false, 1);
let bt2: f64 = tuple.2.into();
println!("{}", bt2);
let bt3: bool = tuple.3;
println!("{}", bt3);
```

#### æ•°ç»„
å°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªåŒä¸€ç±»å‹çš„å€¼é›†åˆ, æ•°ç»„å…ƒç´ çš„ç±»å‹å¿…é¡»ä¸€è‡´, æ•°ç»„ä¸€æ—¦å£°æ˜é•¿åº¦ä¸å¯å˜. 
```rust
let array = [0, 1, 2, 3, 4, 5, 6];
println!("0:{} 5:{}", array[0], array[5]);
```
å¦‚æœè®¿é—®æ•°ç»„ç´¢å¼•ä¹‹å¤–çš„æ•°æ®, ç¼–è¯‘æ—¶ä¼šæç¤º: `index out of bounds`, è¿è¡Œæ—¶ç¨‹åºä¼šå¼‚å¸¸


### å‡½æ•°

å‡½æ•°å£°æ˜  
```rust
fn zero() -> u8 {
    0
}
```
è¿”å›æ•°å­— **0**, å‡½æ•°ä½“æ˜¯è¡¨è¾¾å¼ `0`

```rust
fn fun(param: u32) -> u32 {
  return param + 100;
}
```
å…¥å‚å’Œå‡½æ•°è¿”å›ç±»å‹éƒ½æ˜¯ `u32`, å‡½æ•°ä½“æ˜¯è¯­å¥ `return param + 100;`

ä½¿ç”¨å…ƒç»„è¿”å›å¤šä¸ªå€¼
```rust
fn fun_tuple(val: String) -> (String, usize) {
    let len = val.len();
    (val, len)
}

// ä½¿ç”¨å‡½æ•°è¿”å›çš„å…ƒç»„
// æ–¹å¼ä¸€ 
let fun_tuple_res: (String, usize) = fun_tuple(String::from("yakir"));
println!("{} {}", fun_tuple_res.0, fun_tuple_res.1);
// æ–¹å¼äºŒ
let (val0, val1) = fun_tuple(String::from("yakir"));
println!("{} {}", val0, val1);
```

#### å‡½æ•°ä½“è¯­å¥(Statements)ä¸è¡¨è¾¾å¼(Expressions)

```rust
let sum = {
    let one = 1;
    one + 1
};
```
è¯­å¥ä»£ç å—ä¸­è¡¨è¾¾å¼  
```rust
{
    let one = 1;
    one + 1
}
```
è¿”å› `2`, è¿”å›å€¼ç»‘å®šåˆ°å˜é‡ `sum` ä¸Š, è¡¨è¾¾å¼ä¸­ `one + 1` ç»“æŸæ—¶ä¸åŒ…å« `;` è¡¨æ˜**è¡¨è¾¾å¼ä¸åŒ…å«åˆ†å·(;)**. å‡½æ•°å’Œè¡¨è¾¾å¼éƒ½å¯ä»¥è¿”å›å€¼


### æµç¨‹æ§åˆ¶

#### if è¡¨è¾¾å¼
```rust
if <é€»è¾‘è¡¨è¾¾å¼> {
    // åšä¸€äº›äº‹æƒ…
}
```
å› ä¸º`if`æ˜¯ä¸€ä¸ª**è¡¨è¾¾å¼**, æ‰€ä»¥è¡¨è¾¾å¼çš„æ‰§è¡Œç»“æœæ˜¯æœ‰è¿”å›å€¼çš„, å¯ä»¥å°†`if`çš„æ‰§è¡Œç»“æœèµ‹ç»™å˜é‡(**ç¡®ä¿`if`è¡¨è¾¾å¼çš„æ¯ä¸ªåˆ†æ”¯è¿”å›ç»“æœæ˜¯åŒä¸€ç±»å‹**)  
```rust
let hi = if val == 0 {
    "ä½ å¥½ !"
}else if val == 1 {
    "Bonjour !"
}else if val == 2 {
    "Hello !"
} else {
    "ğŸ¤©"
};
println!("{}", hi);
```

#### loop é‡å¤æ‰§è¡Œ

```rust
loop {
    println!("loop");
}
```

è¿è¡Œä¹‹åéœ€è¦æ‰‹åŠ¨åœæ­¢ç¨‹åº

#### while å¾ªç¯

`while` æ¡ä»¶å¾ªç¯
```rust
let mut loop_nu = 3;
while loop_nu > 0 {
    println!("while æ¡ä»¶å¾ªç¯ {}", loop_nu);
    loop_nu = loop_nu - 1;
}
```

`while` é›†åˆè¿­ä»£å¾ªç¯ _(æ¡ä»¶å¾ªç¯çš„ä¸€ç§ä½¿ç”¨åœºæ™¯)_
```rust
let array = [0, 1, 2, 3, 4, 5, 6];
let mut index = 0;
while index < 7 {
    println!("æ•°ç»„å…ƒç´  while å¾ªç¯ {}", array[index]);
    index = index + 1;
}
```

æ¡ä»¶ `loop_nu > 0` æˆç«‹çš„æ—¶å€™æ‰§è¡Œå¾ªç¯ä½“, æ¡ä»¶ä¸æ»¡è¶³çš„æ—¶å€™é€€å‡ºå¾ªç¯

#### for å¾ªç¯

`for` å¾ªç¯è¿­ä»£é›†åˆ
```rust
let array = [0, 1, 2, 3, 4, 5, 6];
for ele in array.iter() {
    println!("æ•°ç»„å…ƒç´  {}", ele);
}
```

`for` å¾ªç¯ `Rang`
```rust
for number in (1..4) {
    println!("{}", number);
}
```
`(1..4)` ä½¿ç”¨äº†æ ‡å‡†åº“ä¸­ `Range`, ç”¨æ¥ç”Ÿæˆä»ä¸€ä¸ªæ•°å­—åˆ°å¦ä¸€ä¸ªæ•°å­—ä¹‹å‰çš„æ‰€æœ‰æ•°å­—åºåˆ—


### æ‰€æœ‰æƒ(ownership)

#### å †(heap)å’Œæ ˆ(stack)
- æ ˆ
  æ ˆä»¥æ”¾å…¥å€¼çš„é¡ºåºå­˜å‚¨, ä»¥ç›¸åçš„é¡ºåºå–å‡ºå€¼(å…ˆè¿›åå‡º \ last in, first out)  
  æ·»åŠ æ•°æ®å«**è¿›æ ˆ**(pushing onto the stack), ç§»å‡ºæ•°æ®å«**å‡ºæ ˆ**(å¼¹æ ˆ \ popping off the stack)

- å †
  å¯¹äºåœ¨ç¼–è¯‘æ—¶æ•°æ®å¤§å°ä¸å®šçš„æ•°æ®å­˜å‚¨åœ¨å †ä¸­. å½“å‘å †ä¸­å­˜å‚¨æ•°æ®æ—¶, ç¨‹åºè¯·æ±‚ä¸€å®šå¤§å°çš„ç©ºé—´, æ“ä½œç³»ç»Ÿåœ¨å †ä¸­æ‰¾åˆ°ç©ºé—´å¹¶æ ‡è®°ä¸ºå·²ä½¿ç”¨, è¿”å›è¿™å—ç©ºé—´çš„**æŒ‡é’ˆ**(pointer). è¿™ä¸ªè¿‡ç¨‹ç§°ä½œåœ¨**å †ä¸­åˆ†é…å†…å­˜**(allocating on the heap).  
  è·å–åˆ°çš„**æŒ‡é’ˆå­˜å‚¨åœ¨æ ˆä¸­**, éœ€è¦è®¿é—®å †ä¸­çš„æ•°æ®æ—¶, å¯ä»¥é€šè¿‡æŒ‡é’ˆè·å–

å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°, ä¼ é€’ç»™å‡½æ•°çš„å€¼(åŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆ)å’Œå‡½æ•°çš„å±€éƒ¨å˜é‡è¢«å‹å…¥æˆ˜ä¸­. å½“å‡½æ•°ç»“æŸæ—¶, è¿™äº›å€¼è¢«ç§»å‡ºæ ˆ(å¼¹æ ˆ).  
æ‰€æœ‰æƒç³»ç»Ÿéœ€è¦å¤„ç†çš„é—®é¢˜, è®°å½•ä½•å¤„çš„ä»£ç åœ¨ä½¿ç”¨å †ä¸Šçš„æ•°æ®, æœ€å°åŒ–å †ä¸Šçš„å†—ä½™æ•°æ®çš„æ•°é‡ä»¥åŠæ¸…ç†å †ä¸Šä¸å†ä½¿ç”¨çš„æ•°æ®(é¿å…è€—å°½ç©ºé—´).  


#### æ‰€æœ‰æƒè§„åˆ™

1. æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ª**æ‰€æœ‰è€…** _(owner)_ å˜é‡
2. å€¼æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
3. å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸ, è¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ

#### å˜é‡ä½œç”¨åŸŸ(scope)

```rust
{
    let var = "Hello";
}
```
å˜é‡ `var` çš„ä½œç”¨åŸŸæ˜¯åœ¨ `{}` ä¹‹é—´, åœ¨ä½œç”¨åŸŸä¸­å˜é‡æ˜¯æœ‰æ•ˆçš„, ç¦»å¼€ä½œç”¨åŸŸå˜é‡æ˜¯æ— æ•ˆçš„

#### String ç±»å‹

ä½¿ç”¨ `String` çš„ `from` å‡½æ•°, ä»å­—ç¬¦ä¸²å­—é¢é‡åˆ›å»º `String`
```rust
let name = String::from("yakir");
```

ä¿®æ”¹å­—ç¬¦ä¸²
```rust
let mut name = String::from("yakir");
name.push_str("Chen");  // å­—ç¬¦ä¸²è¿½åŠ  "yakirChen"
```
ç¬¬ä¸€éƒ¨åˆ†åœ¨ç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šå˜é‡æ‰€å å†…å­˜ç©ºé—´çš„å¤§å°.  
ç¬¬äºŒéƒ¨åˆ†åœ¨è¿è¡Œæ—¶ä¿®æ”¹å­—ç¬¦ä¸².
  - ç¨‹åºéœ€è¦åœ¨è¿è¡Œæ—¶å‘æ“ä½œç³»ç»Ÿè¯·æ±‚å†…å­˜ç©ºé—´
  - å¤„ç†å®Œ`String`ä¹‹åéœ€è¦å°†å†…å­˜è¿”è¿˜ç»™æ“ä½œç³»ç»Ÿ

å˜é‡åœ¨ç¦»å¼€ä½œç”¨åŸŸä¹‹å, å®ƒæ‰€å ç”¨çš„å†…å­˜ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾. å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸ, Rustä¼šè°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•° `drop` 

`String`ç”±ä¸‰éƒ¨åˆ†ç»„æˆ 1. ä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹å†…å­˜çš„æŒ‡é’ˆ, 2. é•¿åº¦, 3. å®¹é‡

å˜é‡ä¸æ•°æ®äº¤äº’ä¸€: ç§»åŠ¨  
```rust
let s1 = String::from("yakir");
let s2  = s1;
```
å½“æŠŠs1èµ‹å€¼ç»™s2çš„æ—¶å€™ ä» _**æ ˆä¸Š**_ æ‹·è´äº† `s1` å˜é‡(s1çš„æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡), å¹¶ _**æ²¡æœ‰å¤åˆ¶**_ æŒ‡é’ˆæŒ‡å‘çš„ _**å †ä¸Šçš„æ•°æ®**_ .  
è¿™ä¸ªæ—¶å€™ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘äº†å †ä¸­çš„åŒä¸€å—æ•°æ®, `s1` å’Œ `s2` ç¦»å¼€äº†ä½œç”¨åŸŸ, é‚£å˜é‡ç¦»å¼€äº†ä½œç”¨åŸŸéƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„ä¸€å—å†…å­˜, ä¼šäº§ç”Ÿä¸€ä¸ªäºŒæ¬¡é‡Šæ”¾(double free)çš„é”™è¯¯.  
`Rust`ä¸ºä¿è¯å†…å­˜å®‰å…¨, è¿™ä¸ªåœºæ™¯ä¸­ `Rust` è®¤ä¸º `s1` ä¸å†æœ‰æ•ˆ(å˜é‡ä¸èƒ½å†ä½¿ç”¨), å› æ­¤ `s1` å°±ä¸ç”¨æ¸…ç†


å˜é‡ä¸æ•°æ®äº¤äº’äºŒ: å…‹éš†  
```rust
let s1 = String::from("yakir");
let s2  = s1.clone();
```
åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡ç»‘å®šå…‹éš†çš„æ•°æ®

åªåœ¨æ ˆä¸Šçš„æ•°æ®: æ‹·è´  
å¯¹äºä¸€äº›åœ¨ç¼–è¯‘æ—¶å°±å·²çŸ¥å­˜å‚¨å¤§å°çš„ç±»å‹è¢«å­˜å‚¨åœ¨æ ˆä¸Š, æ‹·è´å®é™…çš„å€¼æ˜¯å¿«é€Ÿçš„, ä¸”ä¸ä¼šä½¿å˜é‡è¢«æ‹·è´ååŸå€¼æ— æ•ˆåŒ–  
Rust æœ‰ä¸€ä¸ª `Copy` ç‰¹æ€§(trait)çš„ç‰¹æ®Šæ³¨è§£, å¯ä»¥ä½œç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·ç›´æ¥å­˜å‚¨åœ¨æ ˆä¸Šçš„ç±»å‹  
å¯ä»¥ä½¿ç”¨`Copy`ç‰¹æ€§çš„ç±»å‹  
- æ‰€æœ‰æ•´æ•°ç±»å‹
- å¸ƒå°”ç±»å‹
- æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹
- å…ƒç»„, å½“ä¸”ä»…å½“å…ƒç»„åŒ…å«çš„æ•°æ®ç±»å‹ä¹Ÿæ˜¯`Copy`çš„æ—¶å€™

#### æ‰€æœ‰æƒå’Œå‡½æ•°

å°†å€¼ä¼ é€’ç»™å‡½æ•°æ—¶å¯èƒ½ä¼šå‘ç”Ÿç§»åŠ¨æˆ–è€…å¤åˆ¶, å°†å˜é‡çš„å€¼èµ‹ç»™å˜é‡æ—¶**å˜é‡çš„æ‰€æœ‰æƒä¹Ÿéšç€è½¬ç§»**

```rust
fn main(){
    let age = 18;
    fun_int(age);
    println!("{}", age);

    let yakir: String = String::from("yakir");
    fun_str(yakir);
}
pub fn fun_int(val: u32) -> u32 {
    val
}

pub fn fun_str(val: String) -> String {
    val
}
```
åœ¨è°ƒç”¨`fun_str`å‡½æ•°ä¹‹å, å˜é‡ `yakir` çš„å€¼å‘ç”Ÿäº†ç§»åŠ¨(å°±åƒå¤åˆ¶è¯­å¥ä¸€æ ·)

#### å¼•ç”¨ä¸å€Ÿç”¨

##### å¼•ç”¨(references)  
æŠŠå˜é‡ä¼ é€’ç»™å‡½æ•°çš„æ—¶å€™åœ¨å˜é‡åå‰æ·»åŠ  `&` å¼•ç”¨ç¬¦å·, åŒæ—¶å®šä¹‰å‡½æ•°çš„æ—¶å€™å‡½æ•°ç­¾åå£°æ˜å‚æ•°ç±»å‹æ˜¯å¼•ç”¨(**`&String`**)  
```rust
pub fn fun_str_ref(val: &String) -> usize {
    val.len()
}
let yakir_ref: String = String::from("yakirChen");
fun_str_ref(&yakir_ref);
```
å®è´¨ä¸Šæˆ‘çš„ç†è§£ğŸ˜, å…¥å‚`&String val`æ˜¯ä¸€ä¸ªæŒ‡å‘å˜é‡ `String yakir_ref` çš„æŒ‡é’ˆ, å˜é‡ `yakir_ref` åŒ…å«å¯¹å­—ç¬¦ä¸² "yakirChen" ç›¸å…³çš„ä¿¡æ¯(æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡)

è§£å¼•ç”¨(dereferencing)  
ä¸å¼•ç”¨ `&` ç›¸å¯¹æ“ä½œæ˜¯è§£å¼•ç”¨ `*`

å°†è·å–å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°ç§°ä¸º**å€Ÿç”¨(borrowing)**, _**å€Ÿç”¨çš„å˜é‡åœ¨å‡½æ•°ä½“ä¸­æ˜¯ä¸èƒ½ä¿®æ”¹çš„**_

##### å¯å˜å¼•ç”¨


## :dart: Rusté«˜çº§

.  
.  
.  



---
Reference  
[Rust ç¨‹åºè®¾è®¡è¯­è¨€](https://kaisery.github.io/trpl-zh-cn)
